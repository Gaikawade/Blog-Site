{% extends 'layout.html' %}

{% block contents %}
	<br />
	{% with messages = get_flashed_messages(with_categories=true) %}
		{% if messages %}
		<ul class="flashes">
			{% for category, message in messages %}
				<div class="alert alert-{{category}} alert-dismissible" role="alert">
					{{ message }}
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>
			{% endfor %}
		</ul>
		{% endif %}
	{% endwith %}

	<div class="card" id="show-details" style="display: block">
		<div class="card-header">
			Account Details
		</div>
		<div class="card-body">
		  <h5 class="card-title">Hello <strong>{{current_user.name}}</strong></h5>
		  <br />
		  <div class="card-text">
			<div><strong>User Id: </strong>{{current_user.id}}</div>
			<div><strong>Name: </strong>{{current_user.name}}</div>
			<div><strong>Email: </strong>{{current_user.email}}</div>
			<br />
		  </div>
		</div>
	</div>
	<br />

	{% if current_user.is_admin == false %}
	<div class="btn btn-primary" id="update-btn">Update Details</div>
	<br />
		<div class="container-fluid col-md-4" id="update-form" style="display: none">
		<form action="" method="post">
			{{ form.csrf_token }}

			<div class="form-floating">
				{{ form.name() }} {{ form.name.label }}
				<br />
				{% if form.name.errors %}
					{% for error in form.name.errors %}
						<div class="text-danger"> {{ error }} </div> <br />
					{% endfor %}
				{% endif %}
			</div>

			{% if current_user.is_admin != true %}
			<div class="form-floating">
				{{ form.email() }} {{ form.email.label }}
				<br />
				{% if form.email.errors %}
					{% for error in form.email.errors %}
						<div class="text-danger"> {{ error }} </div> <br />
					{% endfor %}
				{% endif %}
			</div>
			{% endif %}

			<div class="form-floating">
				{{ form.old_password() }} {{ form.old_password.label }}
				<br />
				{% if form.old_password.errors %}
					{% for error in form.old_password.errors %}
						<div class="text-danger"> {{ error }} </div> <br />
					{% endfor %}
				{% endif %}
			</div>

			<div class="form-floating">
				{{ form.new_password() }} {{ form.new_password.label }}
				<br />
				{% if form.new_password.errors %}
					{% for error in form.new_password.errors %}
						<div class="text-danger"> {{ error }} </div> <br />
					{% endfor %}
				{% endif %}
			</div>

			<div class="form-floating">
				{{ form.confirm_new_password() }} {{ form.confirm_new_password.label }}
				<br />
				{% if form.confirm_new_password.errors %}
					{% for error in form.confirm_new_password.errors %}
						<div class="text-danger"> {{ error }} </div> <br />
					{% endfor %}
				{% endif %}
			</div>

			<div id="success"></div>
			{{ form.submit() }}
		</form>
	</div>
	{% endif %}

{% endblock contents %}